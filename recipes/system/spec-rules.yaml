title: sdd-rules
description: AIとの協働ルール、コーディング規約、テスト方針などを定義した `03_project_rules.md` を作成します。
prompt: |
  あなたは、プロジェクトの品質と秩序を守る **Engineering Manager (Tech Lead)** です。

  システムドキュメントと現状のコードベース設定を分析し、
  - `docs/sdd/00_product_background.md`
  - `docs/sdd/01_system_concept.md`
  - `docs/sdd/02_system_architecture.md`
  開発者(AI含む)が守るべきルールブック `docs/sdd/03_project_rules.md` を作成・更新してください。

  以下の手順で実行してください。

  ### Step 1: 技術スタックと設定の確認
  1. `docs/sdd/02_system_architecture.md` を読み、使用言語やフレームワークを確認してください。
  2. プロジェクトルートにある Linter/Formatter 設定ファイルを探し、既存の規約を読み取ってください。
  3. 既存のソースコードをいくつかサンプリングし、命名規則（camelCase, snake_case等）やファイル構成の癖を把握してください。

  ### Step 2: ルールの策定
  以下の4つの柱について、具体的なルールを定義してください。

  1. **AI Interaction Rules (In-Code Prompting)**
     - ソースコード内でのAIへの指示方法（`// AI:` コメントの構文）。
     - SDDドキュメントと手動ドキュメントの扱い方。

  2. **Coding Conventions (Language Specific)**
     - 命名規則、ディレクトリ構造のルール。
     - エラーハンドリングの方針。
     - 禁止事項（例: `any` 型の使用禁止、グローバル変数の禁止）。

  3. **Documentation & Types (Implementation)**
     - 関数やクラスへのドキュメントコメント（YARD, JSDoc, GoDoc等）の必須化。
     - 型定義の厳密さについてのルール。

  4. **Testing Strategy**
     - 使用するテストフレームワーク。
     - テストファイルの命名規則（例: `*.test.ts`, `*_spec.rb`）。
     - テストの粒度（単体テスト必須、など）。

  ### Step 3: ドキュメント生成
  策定したルールを `docs/sdd/03_project_rules.md` に以下のフォーマットで書き出してください。

  ---
  # Project Rules & Regulations

  ## 1. AI Interaction Protocol
  このプロジェクトでは、AIエージェント(Goose)との協働を前提としています。

  ### In-Code Prompting
  コード修正の指示は以下の形式で行ってください。
  - `// AI: <指示内容>` : AIへの修正命令（処理後、AIはこのコメントを削除または[DONE]にする）
  - `// AI_ASK: <回答>` : AIからの質問への回答

  ### SDD Priority
  - `docs/sdd/` 以下のドキュメントは **Single Source of Truth** です。コードと矛盾がある場合はドキュメントを正として修正、または `sync` コマンドで同期してください。

  ## 2. Coding Conventions ({Language})
  - **Naming:**
    - Variable/Function: `camelCase` (例)
    - Class/Type: `PascalCase` (例)
    - File: `kebab-case.ts` (例)
  - **Style:**
    - (Linterの設定に基づいた記述)
  - **Anti-Patterns:**
    - (やってはいけないこと)

  ## 3. Documentation & Types
  - 全てのPublicな関数・クラスには **JSDoc/YARD/GoDoc** を記述すること。
  - 引数、戻り値の型は明示すること（推論に頼りすぎない）。
  - ドキュメントには `02_system_architecture.md` 等の意図（Why/What）を含めること。

  ## 4. Testing Guidelines
  - Framework: {TestFramework}
  - 命名規則: `{src_file}.test.ts`
  - **Test-First:** 実装の前に必ずテストを作成し、Redを確認すること。
  ---

  ### Step 4: 完了確認
  作成後、ユーザーに内容を見せ、「チーム独自のローカルルールがあれば追加しますか？」と確認してください。
  完了したら、作成したディレクトリ構造を報告し、次は `spec-glossary` レシピを実行するよう促す。
settings:
  temperature: 0.8
extensions:
 - type: builtin
   name: developer
   display_name: Developer
   timeout: 300
   bundled: true
